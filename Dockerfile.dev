# Rust开发环境Docker镜像
FROM rust:1.70-bullseye

# 安装系统依赖
RUN apt-get update && apt-get install -y \
    cmake \
    build-essential \
    pkg-config \
    libssl-dev \
    libsasl2-dev \
    libzstd-dev \
    liblz4-dev \
    perl \
    git \
    curl \
    wget \
    && rm -rf /var/lib/apt/lists/*

# 设置工作目录
WORKDIR /workspace

# 复制Cargo配置文件
COPY Cargo.toml Cargo.lock ./

# 创建虚拟的main.rs文件来预编译依赖
RUN mkdir -p src && echo "fn main() {}" > src/main.rs

# 预编译依赖（加速后续编译）
RUN cargo build --release && rm -rf src

# 设置环境变量
ENV RUST_LOG=debug
ENV RUST_BACKTRACE=1

# 暴露端口
EXPOSE 8000 8001 8002

# 默认命令
CMD ["bash"]