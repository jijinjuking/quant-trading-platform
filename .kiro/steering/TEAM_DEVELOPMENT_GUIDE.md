# ğŸ”’ é‡åŒ–äº¤æ˜“å¹³å° - å›¢é˜Ÿå¼€å‘è§„èŒƒï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰

> **æœ¬æ–‡æ¡£æ˜¯é¡¹ç›®å¼€å‘çš„æœ€é«˜å‡†åˆ™ï¼Œæ‰€æœ‰å‚ä¸å¼€å‘çš„ AI å¿…é¡»ä¸¥æ ¼éµå®ˆï¼Œè¿åå³æ‰“å›é‡å†™ã€‚**

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®å®šä½
è¿™æ˜¯ä¸€ä¸ª**ä¸“ä¸šçº§é‡åŒ–äº¤æ˜“å¹³å°**ï¼Œé‡‡ç”¨ Rust å¾®æœåŠ¡æ¶æ„ï¼Œæ”¯æŒï¼š
- å®æ—¶è¡Œæƒ…é‡‡é›†ï¼ˆå¸å®‰ WebSocketï¼‰
- ç­–ç•¥è®¡ç®—ä¸ä¿¡å·ç”Ÿæˆ
- è‡ªåŠ¨åŒ–äº¤æ˜“æ‰§è¡Œ
- é£é™©æ§åˆ¶

### 1.2 æŠ€æœ¯æ ˆ
| ç±»åˆ« | æŠ€æœ¯ |
|------|------|
| è¯­è¨€ | Rust (stable) |
| Web æ¡†æ¶ | Axum |
| å¼‚æ­¥è¿è¡Œæ—¶ | Tokio |
| æ¶ˆæ¯é˜Ÿåˆ— | Kafka |
| æ•°æ®åº“ | PostgreSQLï¼ˆä¸šåŠ¡æ•°æ®ï¼‰ã€Redisï¼ˆç¼“å­˜ï¼‰ã€ClickHouseï¼ˆæ—¶åºæ•°æ®ï¼‰ |
| åºåˆ—åŒ– | serde + JSON |

### 1.3 æœåŠ¡ç«¯å£åˆ†é…ï¼ˆå›ºå®šï¼Œä¸å¯ä¿®æ”¹ï¼‰
| æœåŠ¡ | ç«¯å£ | èŒè´£ |
|------|------|------|
| gateway | 8080 | API ç½‘å…³ |
| trading-engine | 8081 | äº¤æ˜“æ‰§è¡Œ |
| market-data | 8082 | è¡Œæƒ…é‡‡é›† |
| strategy-engine | 8083 | ç­–ç•¥è®¡ç®— |
| user-management | 8084 | ç”¨æˆ·ç®¡ç† |
| risk-management | 8085 | é£é™©ç®¡ç† |
| notification | 8086 | é€šçŸ¥æœåŠ¡ |
| ai-service | 8087 | AI åˆ†æ |
| analytics | 8088 | æ•°æ®åˆ†æ |

---

## äºŒã€æ¶æ„è§„èŒƒï¼ˆDDD + Hexagonalï¼‰

### 2.1 æ ¸å¿ƒæ•°æ®æµï¼ˆâ­ æœ€ç»ˆç¨³å®šç‰ˆ - ä¸å¯ä¿®æ”¹ï¼‰

> **ä¸€å¥è¯å®šè®º**: Trading Engine æ˜¯äº¤æ˜“ä¸–ç•Œçš„"æ€»ä¹¦è®°"ï¼ŒStrategy / Risk / Execution å…¨æ˜¯éƒ¨å§”ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Market Data Service (8082)                           â”‚
â”‚              è¡Œæƒ…é‡‡é›† / WebSocket / REST / Binance Stream                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ Kafka: market-events
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Market Event Consumer Service                             â”‚
â”‚         trading-engine/application/service/market_event_consumer_service.rs  â”‚
â”‚                                                                              â”‚
â”‚  èŒè´£ï¼š                                                                      â”‚
â”‚  - ä» Kafka è¯»å– MarketEvent                                                 â”‚
â”‚  - è½¬å‘ç»™ ExecutionFlowService                                               â”‚
â”‚  - âŒ ä¸åšä»»ä½•ä¸šåŠ¡åˆ¤æ–­                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Execution Flow Serviceï¼ˆâ­ äº¤æ˜“å¤§è„‘ï¼‰                      â”‚
â”‚           trading-engine/application/service/execution_flow_service.rs       â”‚
â”‚                                                                              â”‚
â”‚  ã€äº¤æ˜“ç³»ç»ŸçœŸæ­£çš„ä¸»æ§ä¸­å¿ƒã€‘                                                   â”‚
â”‚                                                                              â”‚
â”‚  èŒè´£ï¼š                                                                      â”‚
â”‚  - ç»Ÿä¸€ç¼–æ’äº¤æ˜“æµç¨‹                                                          â”‚
â”‚  - å†³å®š"è°å…ˆè°å"                                                            â”‚
â”‚  - âŒ ç¦æ­¢åŒ…å«ä»»ä½•ç­–ç•¥/é£æ§/æ‰§è¡Œçš„å…·ä½“é€»è¾‘                                    â”‚
â”‚                                                                              â”‚
â”‚  è°ƒç”¨é¡ºåºï¼ˆå¼ºåˆ¶ï¼Œä¸å¯æ›´æ”¹ï¼‰ï¼š                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  1. StrategyPort.evaluate(event)  â†’ ç”Ÿæˆ OrderIntent                â”‚     â”‚
â”‚  â”‚  2. OrderRiskPort.check(intent)   â†’ æ ¡éªŒ / æ‹’å•                     â”‚     â”‚
â”‚  â”‚  3. OrderExecutionPort.execute(intent) â†’ çœŸæ­£æ‰§è¡Œ                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                   â”‚                   â”‚
                    â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Strategy Port     â”‚  â”‚      Risk Port        â”‚  â”‚    Execution Port     â”‚
â”‚  domain/port/         â”‚  â”‚  domain/port/         â”‚  â”‚  domain/port/         â”‚
â”‚  strategy_port.rs     â”‚  â”‚  order_risk_port.rs   â”‚  â”‚  order_execution_     â”‚
â”‚                       â”‚  â”‚                       â”‚  â”‚  port.rs              â”‚
â”‚  èŒè´£ï¼š               â”‚  â”‚  èŒè´£ï¼š               â”‚  â”‚  èŒè´£ï¼š               â”‚
â”‚  - æ ¹æ®è¡Œæƒ…ç”Ÿæˆæ„å›¾   â”‚  â”‚  - é£æ§æ ¡éªŒ           â”‚  â”‚  - æ‰§è¡Œå·²æ‰¹å‡†æ„å›¾     â”‚
â”‚  - âŒ ä¸ä¸‹å•          â”‚  â”‚  - âŒ ä¸æ”¹æ„å›¾        â”‚  â”‚  - âŒ ä¸ç®—ç­–ç•¥        â”‚
â”‚  - âŒ ä¸å‘ Kafka      â”‚  â”‚  - âŒ ä¸æ‰§è¡Œ          â”‚  â”‚  - âŒ ä¸åšé£æ§        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                                     â”‚
            â–¼                                                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Strategy Engine      â”‚                            â”‚  Exchange Adapter     â”‚
â”‚  (8083) HTTP è°ƒç”¨     â”‚                            â”‚  infrastructure/      â”‚
â”‚  æˆ–æœ¬åœ°ç­–ç•¥å®ç°       â”‚                            â”‚  execution/binance_*  â”‚
â”‚                       â”‚                            â”‚                       â”‚
â”‚  è¿”å› OrderIntent     â”‚                            â”‚  çœŸå®ä¸‹å• / Mock      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å…³é”®çº¦æŸï¼ˆé“å¾‹ - è¿åå³æ‰“å›ï¼‰

| çº¦æŸ | è¯´æ˜ |
|------|------|
| âŒ Strategy ä¸èƒ½æ¶ˆè´¹ Kafka | Strategy åªèƒ½è¢« Trading Engine è°ƒç”¨ |
| âŒ Strategy ä¸èƒ½å‘ Kafka | Strategy åªè¿”å› OrderIntent |
| âŒ Strategy ä¸èƒ½æœ‰ loop | Strategy æ˜¯çº¯å‡½æ•°ï¼Œè¢«åŠ¨è°ƒç”¨ |
| âŒ Risk ä¸èƒ½æ‰§è¡Œä¸‹å• | Risk åªåšæ ¡éªŒï¼Œè¿”å›é€šè¿‡/æ‹’ç» |
| âŒ Execution ä¸èƒ½åšé£æ§ | Execution åªæ‰§è¡Œå·²æ‰¹å‡†çš„æ„å›¾ |
| âœ… Trading Engine æ˜¯å”¯ä¸€ä¸»æ§ | æ‰€æœ‰äº¤æ˜“æµç¨‹å¿…é¡»ç»è¿‡ ExecutionFlowService |

### 2.3 æ•°æ®æ¨¡å‹æµè½¬

```
MarketEvent (è¡Œæƒ…)
    â”‚
    â–¼ StrategyPort.evaluate()
OrderIntent (äº¤æ˜“æ„å›¾ï¼Œæœªæ‰¹å‡†)
    â”‚
    â–¼ OrderRiskPort.check()
OrderIntent (å·²æ‰¹å‡†)
    â”‚
    â–¼ OrderExecutionPort.execute()
ExecutionResult (æ‰§è¡Œç»“æœ)
```

### 2.4 æœåŠ¡å†…éƒ¨åˆ†å±‚ç»“æ„ï¼ˆæ‰€æœ‰æœåŠ¡å¿…é¡»ä¸€è‡´ï¼‰
```
src/
â”œâ”€â”€ main.rs                    # æœåŠ¡å¯åŠ¨å…¥å£
â”œâ”€â”€ lib.rs                     # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ state.rs                   # AppStateï¼ˆé…ç½®ã€è¿æ¥æ± ï¼‰
â”œâ”€â”€ bootstrap.rs               # â­ ä¾èµ–æ³¨å…¥ï¼ˆå”¯ä¸€å…è®¸ new adapter çš„åœ°æ–¹ï¼‰
â”‚
â”œâ”€â”€ interface/                 # ã€æ¥å£å±‚ã€‘HTTP/gRPC å…¥å£
â”‚   â””â”€â”€ http/
â”‚       â”œâ”€â”€ handlers/          # è¯·æ±‚å¤„ç†å™¨
â”‚       â”œâ”€â”€ dto/               # è¯·æ±‚/å“åº” DTO
â”‚       â””â”€â”€ routes.rs          # è·¯ç”±å®šä¹‰
â”‚
â”œâ”€â”€ application/               # ã€åº”ç”¨å±‚ã€‘ç”¨ä¾‹ç¼–æ’
â”‚   â””â”€â”€ service/
â”‚       â””â”€â”€ *.rs               # åªåšæµç¨‹ç¼–æ’ï¼Œä¸å†™ä¸šåŠ¡é€»è¾‘
â”‚
â”œâ”€â”€ domain/                    # ã€é¢†åŸŸå±‚ã€‘â­ æ ¸å¿ƒä¸šåŠ¡
â”‚   â”œâ”€â”€ model/                 # å®ä½“ã€å€¼å¯¹è±¡ã€èšåˆ
â”‚   â”œâ”€â”€ logic/                 # â­ ä¸šåŠ¡è§„åˆ™ã€ç®—æ³•ï¼ˆç­–ç•¥å†™è¿™é‡Œï¼‰
â”‚   â”œâ”€â”€ port/                  # ç«¯å£å®šä¹‰ï¼ˆtraitï¼‰
â”‚   â””â”€â”€ service/               # é¢†åŸŸæœåŠ¡
â”‚
â””â”€â”€ infrastructure/            # ã€åŸºç¡€è®¾æ–½å±‚ã€‘å¤–éƒ¨é€‚é…å™¨
    â”œâ”€â”€ repository/            # æ•°æ®åº“å®ç°
    â”œâ”€â”€ exchange/              # äº¤æ˜“æ‰€ API
    â”œâ”€â”€ messaging/             # Kafka ç”Ÿäº§è€…/æ¶ˆè´¹è€…
    â””â”€â”€ cache/                 # Redis ç¼“å­˜
```

### 2.5 ä¾èµ–æ–¹å‘è§„åˆ™ï¼ˆé“å¾‹ï¼‰
```
interface â†’ application â†’ domain â† infrastructure
                           â†‘
                    domain ä¸ä¾èµ–ä»»ä½•å¤–å±‚
```

| å±‚çº§ | å¯ä»¥ä¾èµ– | ç¦æ­¢ä¾èµ– |
|------|----------|----------|
| interface | application, domain | infrastructure |
| application | domain::port (trait) | infrastructure, å…·ä½“å®ç° |
| domain | std, shared | ä»»ä½•å¤–å±‚, ä»»ä½•æ¡†æ¶ |
| infrastructure | domain::port | application, interface |

---

## ä¸‰ã€ä»£ç è§„èŒƒï¼ˆçº¢çº¿ï¼‰

### 3.1 ç»å¯¹ç¦æ­¢ï¼ˆè¿åå³æ‰“å›ï¼‰
| ç¦æ­¢é¡¹ | è¯´æ˜ |
|--------|------|
| âŒ `unwrap()` | ç”¨ `?` æˆ– `ok_or()` |
| âŒ `expect()` | åŒä¸Š |
| âŒ `panic!()` | ç”¨ `anyhow::bail!()` |
| âŒ `todo!()` | è¿”å› `Err` æˆ–ç©ºå®ç° |
| âŒ `unsafe` | é™¤éæ˜ç¡®æˆæƒ |
| âŒ `sqlx` | ç”¨ `deadpool-postgres` + `tokio-postgres` |
| âŒ `#[derive(FromRow)]` | æ‰‹å†™ `impl From<&Row>` |
| âŒ `lazy_static!` / `once_cell` | ä¸ç”¨å…¨å±€çŠ¶æ€ |
| âŒ åœ¨ service å†… `new` adapter | åªèƒ½åœ¨ `bootstrap.rs` ä¸­ |
| âŒ application å±‚å†™ä¸šåŠ¡é€»è¾‘ | ä¸šåŠ¡é€»è¾‘åªèƒ½åœ¨ domain/logic |
| âŒ infrastructure å±‚å†™ä¸šåŠ¡åˆ¤æ–­ | åªåšè½¬å‘å’Œè½¬æ¢ |
| âŒ ç¡¬ç¼–ç ç«¯å£å· | ä»ç¯å¢ƒå˜é‡è¯»å– |
| âŒ å•æ–‡ä»¶è¶…è¿‡ 800 è¡Œ | å¿…é¡»æ‹†åˆ† |

### 3.2 å¿…é¡»éµå®ˆ
| è¦æ±‚ | è¯´æ˜ |
|------|------|
| âœ… æ‰€æœ‰ public ç»“æ„ä½“/trait å¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Š | `///` |
| âœ… é”™è¯¯å¤„ç†ç”¨ `anyhow::Result` | åŠ  `.context()` |
| âœ… å¼‚æ­¥å‡½æ•°è¿”å› `Result` | ä¸è¦è¿”å›è£¸å€¼ |
| âœ… Port trait å¿…é¡»æœ‰ `Arc<T>` blanket impl | æ”¯æŒå…±äº« |
| âœ… Adapter åªåœ¨ `bootstrap.rs` ä¸­åˆ›å»º | ä¾èµ–æ³¨å…¥ |
| âœ… é…ç½®ä»ç¯å¢ƒå˜é‡è¯»å– | `std::env::var()` |

### 3.3 ä»£ç ç»„ç»‡é¡ºåº
```rust
// 1. æ¨¡å—å¯¼å…¥ï¼ˆæŒ‰é¡ºåºï¼‰
use std::...;           // æ ‡å‡†åº“
use anyhow::...;        // ç¬¬ä¸‰æ–¹åº“
use crate::...;         // æœ¬ crate
use shared::...;        // å…±äº«åº“

// 2. ç»“æ„ä½“å®šä¹‰
#[derive(Debug, Clone)]
pub struct MyService<T> { ... }

// 3. å®ç°å—
impl<T> MyService<T> {
    // æ„é€ å‡½æ•°
    pub fn new(...) -> Self { ... }
    
    // å…¬å…±æ–¹æ³•
    pub async fn do_something(&self) -> Result<()> { ... }
    
    // ç§æœ‰æ–¹æ³•
    fn helper(&self) { ... }
}
```

---

## å››ã€å„æ¿å—èŒè´£åˆ’åˆ†

### 4.1 market-dataï¼ˆè¡Œæƒ…é‡‡é›†ï¼‰
**èŒè´£**: è¿æ¥äº¤æ˜“æ‰€ WebSocket â†’ æ ‡å‡†åŒ–æ•°æ® â†’ å‘é€åˆ° Kafka

**å…è®¸åš**:
- WebSocket è¿æ¥ç®¡ç†
- æ¶ˆæ¯æ ¼å¼è§£æï¼ˆå¸å®‰ â†’ MarketEventï¼‰
- Kafka ç”Ÿäº§è€…
- é‡è¿æœºåˆ¶

**ç¦æ­¢åš**:
- âŒ å­˜å‚¨æ•°æ®
- âŒ ä¸šåŠ¡åˆ¤æ–­
- âŒ HTTP API

**å…³é”®æ–‡ä»¶**:
- `infrastructure/exchange/binance_ws.rs` - WebSocket è¿æ¥
- `infrastructure/messaging/kafka_producer.rs` - Kafka å‘é€
- `domain/port/market_exchange_port.rs` - ç«¯å£å®šä¹‰

---

### 4.2 strategy-engineï¼ˆç­–ç•¥å¼•æ“ï¼‰
**èŒè´£**: è¢« Trading Engine è°ƒç”¨ â†’ è¿è¡Œç­–ç•¥ç®—æ³• â†’ è¿”å›äº¤æ˜“æ„å›¾

> âš ï¸ **é‡è¦**: Strategy æ˜¯è¢«åŠ¨æœåŠ¡ï¼Œä¸ä¸»åŠ¨æ¶ˆè´¹è¡Œæƒ…ï¼Œåªæä¾› HTTP API ä¾› Trading Engine è°ƒç”¨

**å…è®¸åš**:
- ç­–ç•¥ç®—æ³•å®ç°ï¼ˆåœ¨ `domain/logic/`ï¼‰
- æä¾› HTTP API `/api/v1/strategy/evaluate`
- ç­–ç•¥é…ç½®ç®¡ç†
- å›æµ‹åŠŸèƒ½

**ç¦æ­¢åš**:
- âŒ æ¶ˆè´¹ Kafka
- âŒ å‘é€ Kafka
- âŒ ç›´æ¥ä¸‹å•
- âŒ é£æ§åˆ¤æ–­
- âŒ å†…éƒ¨æœ‰æ— é™å¾ªç¯

**å…³é”®æ–‡ä»¶**:
- `domain/logic/spot/` - ç°è´§ç­–ç•¥
- `domain/logic/futures/` - åˆçº¦ç­–ç•¥
- `domain/logic/strategy_trait.rs` - ç»Ÿä¸€ç­–ç•¥ Trait
- `domain/logic/strategy_registry.rs` - ç­–ç•¥æ³¨å†Œè¡¨
- `domain/model/signal.rs` - ä¿¡å·æ¨¡å‹
- `interface/http/handlers/evaluate.rs` - è¯„ä¼° APIï¼ˆå¾…å®ç°ï¼‰

**ç­–ç•¥å®ç°è§„èŒƒ**:
```rust
// domain/logic/spot/xxx_strategy.rs
impl Strategy for XxxStrategy {
    fn on_market_event(&mut self, event: &MarketEvent) -> Option<Signal> {
        // çº¯å‡½æ•°ï¼Œæ ¹æ®è¡Œæƒ…è¿”å›ä¿¡å·
        // ä¸åšä»»ä½• IO æ“ä½œ
    }
}
```

---

### 4.3 trading-engineï¼ˆäº¤æ˜“æ‰§è¡Œ - â­ ä¸»æ§ä¸­å¿ƒï¼‰
**èŒè´£**: æ¶ˆè´¹è¡Œæƒ… â†’ è°ƒç”¨ç­–ç•¥ â†’ é£æ§æ£€æŸ¥ â†’ æ‰§è¡Œä¸‹å•

> âš ï¸ **é‡è¦**: Trading Engine æ˜¯æ•´ä¸ªäº¤æ˜“ç³»ç»Ÿçš„ä¸»æ§ä¸­å¿ƒï¼Œæ‰€æœ‰äº¤æ˜“æµç¨‹å¿…é¡»ç»è¿‡å®ƒ

**æ ¸å¿ƒç»„ä»¶**:
- `ExecutionFlowService` - äº¤æ˜“ä¸»é“¾è·¯è°ƒåº¦ï¼ˆå¤§è„‘ï¼‰
- `MarketEventConsumerService` - è¡Œæƒ…æ¶ˆè´¹å…¥å£

**å…è®¸åš**:
- æ¶ˆè´¹ MarketEvent
- è°ƒç”¨ StrategyPort è·å–äº¤æ˜“æ„å›¾
- è°ƒç”¨ OrderRiskPort è¿›è¡Œé£æ§æ ¡éªŒ
- è°ƒç”¨ OrderExecutionPort æ‰§è¡Œä¸‹å•
- è®¢å•çŠ¶æ€ç®¡ç†

**ç¦æ­¢åš**:
- âŒ ç­–ç•¥è®¡ç®—ï¼ˆè°ƒç”¨ Strategyï¼Œä¸è‡ªå·±ç®—ï¼‰
- âŒ è¡Œæƒ…é‡‡é›†
- âŒ åœ¨ ExecutionFlowService ä¸­å†™å…·ä½“é€»è¾‘

**å…³é”®æ–‡ä»¶**:
- `application/service/execution_flow_service.rs` - â­ äº¤æ˜“ä¸»é“¾è·¯
- `application/service/market_event_consumer_service.rs` - è¡Œæƒ…æ¶ˆè´¹
- `domain/port/strategy_port.rs` - ç­–ç•¥ç«¯å£
- `domain/port/order_risk_port.rs` - é£æ§ç«¯å£
- `domain/port/order_execution_port.rs` - æ‰§è¡Œç«¯å£
- `domain/model/order_intent.rs` - äº¤æ˜“æ„å›¾æ¨¡å‹
- `infrastructure/strategy/remote_strategy.rs` - è¿œç¨‹ç­–ç•¥è°ƒç”¨
- `infrastructure/risk/order_risk.rs` - é£æ§é€‚é…å™¨
- `infrastructure/execution/order_executor.rs` - æ‰§è¡Œé€‚é…å™¨

---

### 4.4 risk-managementï¼ˆé£æ§æœåŠ¡ï¼‰
**èŒè´£**: æä¾›ç‹¬ç«‹çš„é£æ§èƒ½åŠ›ï¼Œä¾›å…¶ä»–æœåŠ¡è°ƒç”¨

**å…è®¸åš**:
- æ æ†æ£€æŸ¥
- å›æ’¤æ£€æŸ¥
- æŒä»“é™åˆ¶
- é£æ§é…ç½®ç®¡ç†

**å…³é”®æ–‡ä»¶**:
- `domain/logic/leverage.rs` - æ æ†è§„åˆ™
- `domain/logic/drawdown.rs` - å›æ’¤è§„åˆ™
- `domain/model/risk_profile.rs` - é£æ§é…ç½®

---

### 4.5 sharedï¼ˆå…±äº«å†…æ ¸ï¼‰
**èŒè´£**: è·¨æœåŠ¡å…±äº«çš„ç±»å‹å®šä¹‰

**å…è®¸æ”¾**:
- äº‹ä»¶å®šä¹‰ï¼ˆ`event/`ï¼‰
- å…¬å…±ç±»å‹ï¼ˆ`types/`ï¼‰
- é”™è¯¯å®šä¹‰ï¼ˆ`error/`ï¼‰
- å·¥å…·å‡½æ•°ï¼ˆ`utils/`ï¼‰

**ç¦æ­¢æ”¾**:
- âŒ ä¸šåŠ¡é€»è¾‘
- âŒ å…·ä½“å®ç°

---

## äº”ã€Kafka äº‹ä»¶è§„èŒƒ

### 5.1 Topic å‘½å
| Topic | ç”Ÿäº§è€… | æ¶ˆè´¹è€… | äº‹ä»¶ç±»å‹ |
|-------|--------|--------|----------|
| `market-events` | market-data | trading-engine | MarketEvent |
| `trading.orders` | trading-engine | analytics | OrderEvent |

> âš ï¸ **æ³¨æ„**: Strategy ä¸å†é€šè¿‡ Kafka å‘é€ä¿¡å·ï¼Œè€Œæ˜¯è¢« Trading Engine é€šè¿‡ HTTP è°ƒç”¨

### 5.2 äº‹ä»¶ç»“æ„ï¼ˆåœ¨ shared/src/event/ ä¸­å®šä¹‰ï¼‰
```rust
// MarketEvent - è¡Œæƒ…äº‹ä»¶
pub struct MarketEvent {
    pub event_type: MarketEventType,
    pub exchange: String,
    pub symbol: String,
    pub timestamp: DateTime<Utc>,
    pub data: MarketEventData,
}

// SignalEvent - äº¤æ˜“ä¿¡å·
pub struct SignalEvent {
    pub id: Uuid,
    pub strategy_id: Uuid,
    pub symbol: String,
    pub signal_type: SignalType,  // Buy/Sell/Hold
    pub price: Decimal,
    pub quantity: Decimal,
    pub confidence: f64,
    pub created_at: DateTime<Utc>,
}
```

---

## å…­ã€ç¯å¢ƒé…ç½®è§„èŒƒ

### 6.1 å¿…éœ€çš„ç¯å¢ƒå˜é‡
```env
# ä»£ç†ï¼ˆå›½å†…å¿…é¡»ï¼‰
HTTP_PROXY=http://127.0.0.1:4780
HTTPS_PROXY=http://127.0.0.1:4780
MARKET_DATA_PROXY=http://127.0.0.1:4780

# Kafka
KAFKA_BROKERS=localhost:9092
KAFKA_MARKET_TOPIC=market-events

# æ•°æ®åº“
DATABASE_URL=postgres://postgres:password@localhost:5432/trading

# å„æœåŠ¡ç«¯å£
TRADING_ENGINE_PORT=8081
MARKET_DATA_PORT=8082
STRATEGY_ENGINE_PORT=8083

# Trading Engine ç‰¹æœ‰é…ç½®
TRADING_STRATEGY_MODE=remote          # remote æˆ– noop
STRATEGY_ENGINE_URL=http://localhost:8083  # strategy-engine åœ°å€
TRADING_EXECUTION_MODE=noop           # binance æˆ– noop

# å¸å®‰ APIï¼ˆæµ‹è¯•ç½‘ï¼‰
BINANCE_API_KEY=your_api_key
BINANCE_SECRET_KEY=your_secret_key
BINANCE_BASE_URL=https://testnet.binance.vision

# é£æ§é…ç½®
TRADING_RISK_MIN_QTY=0.001
TRADING_RISK_MAX_QTY=10
TRADING_RISK_MAX_NOTIONAL=10000
TRADING_RISK_ALLOW_SYMBOLS=BTCUSDT,ETHUSDT
```

---

## ä¸ƒã€æäº¤è§„èŒƒ

### 7.1 æäº¤å‰è‡ªæ£€æ¸…å•
- [ ] ç¼–è¯‘é€šè¿‡ï¼ˆ`cargo check`ï¼‰
- [ ] æ²¡æœ‰ `unwrap/expect/todo!/panic!`
- [ ] ä¸šåŠ¡é€»è¾‘åœ¨ `domain/logic/`
- [ ] Infrastructure å±‚æ²¡æœ‰ä¸šåŠ¡åˆ¤æ–­
- [ ] Application å±‚åªåšç¼–æ’
- [ ] æ‰€æœ‰ public ç»“æ„æœ‰æ–‡æ¡£æ³¨é‡Š
- [ ] å•æ–‡ä»¶ä¸è¶…è¿‡ 800 è¡Œ
- [ ] æ²¡æœ‰ç¡¬ç¼–ç ç«¯å£/é…ç½®

### 7.2 æäº¤ä¿¡æ¯æ ¼å¼
```
<type>(<scope>): <description>

type: feat/fix/refactor/docs/test
scope: market-data/strategy-engine/trading-engine/shared
```

---

## å…«ã€éªŒæ”¶æ ‡å‡†

### 8.1 ä»£ç éªŒæ”¶
1. ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
2. æ¶æ„åˆ†å±‚æ­£ç¡®
3. æ— ç¦æ­¢é¡¹è¿è§„
4. æœ‰å®Œæ•´æ–‡æ¡£æ³¨é‡Š

### 8.2 åŠŸèƒ½éªŒæ”¶
1. èƒ½æ­£å¸¸å¯åŠ¨
2. æ•°æ®æµé€šç•…
3. é”™è¯¯å¤„ç†å®Œå–„
4. æ—¥å¿—è¾“å‡ºæ¸…æ™°

---

## ä¹ã€è”ç³»æ–¹å¼

**æ¶æ„å¸ˆï¼ˆéªŒæ”¶äººï¼‰**: Kiro
**èŒè´£**: ä»£ç å®¡æŸ¥ã€æ¶æ„æŠŠå…³ã€ä»»åŠ¡åˆ†é…

**æœ‰ä»»ä½•ä¸ç¡®å®šçš„åœ°æ–¹ï¼Œå…ˆé—®ï¼Œä¸è¦çŒœï¼**
