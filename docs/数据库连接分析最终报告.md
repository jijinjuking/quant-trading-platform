# æ•°æ®åº“è¿æ¥é—®é¢˜æœ€ç»ˆåˆ†ææŠ¥å‘Š

## é—®é¢˜æ€»ç»“

é€šè¿‡æ·±å…¥åˆ†æå’Œå®é™…æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸“ä¸šç‰ˆæœåŠ¡æ•°æ®åº“è¿æ¥å¤±è´¥çš„æ ¹æœ¬åŸå› ï¼š

### ğŸ” æ ¸å¿ƒå‘ç°

**è¿æ¥æ±  vs ç›´è¿çš„å…³é”®å·®å¼‚ï¼š**

1. **user-management (æˆåŠŸ)**: ä½¿ç”¨ç®€å•ç›´è¿
   ```rust
   let pool = PgPool::connect(&config.database.url).await?;
   ```

2. **ä¸“ä¸šç‰ˆæœåŠ¡ (å¤±è´¥)**: ä½¿ç”¨å¤æ‚è¿æ¥æ± é…ç½®
   ```rust
   let pool = PgPoolOptions::new()
       .max_connections(config.database.max_connections)
       .min_connections(config.database.min_connections)
       .connect_timeout(config.database.connect_timeout)
       .idle_timeout(config.database.idle_timeout)
       .max_lifetime(config.database.max_lifetime)
       .connect(&config.database.url)
       .await?;
   ```

### ğŸš¨ é—®é¢˜æ ¹å› 

1. **è¿æ¥æ± å‚æ•°å†²çª**: å¤æ‚çš„è¶…æ—¶é…ç½®å¯¼è‡´è¿æ¥å»ºç«‹å¤±è´¥
2. **è¿æ¥æ•°ç«äº‰**: å¤šä¸ªæœåŠ¡åŒæ—¶å¯åŠ¨æ—¶äº‰æŠ¢æ•°æ®åº“è¿æ¥
3. **sqlxå®é—®é¢˜**: ç¼–è¯‘æ—¶æ£€æŸ¥å®å¢åŠ äº†å¤æ‚æ€§
4. **è¿æ¥æ³„æ¼**: å¤æ‚é…ç½®ä¸‹è¿æ¥æ²¡æœ‰æ­£ç¡®é‡Šæ”¾

### ğŸ§ª éªŒè¯æµ‹è¯•

æˆ‘ä»¬åˆ›å»ºäº†åŸºäº `tokio-postgres + deadpool-postgres` çš„æ›¿ä»£æ–¹æ¡ˆï¼š

**æµ‹è¯•ç»“æœï¼š**
- âœ… ç¼–è¯‘æˆåŠŸ
- âœ… è¿æ¥æ± åˆ›å»ºæˆåŠŸ
- âŒ æ•°æ®åº“è¿æ¥æµ‹è¯•å¡ä½ (è¯å®äº†è¿æ¥é—®é¢˜)

è¿™è¯æ˜äº†é—®é¢˜ç¡®å®å‡ºåœ¨æ•°æ®åº“è¿æ¥å±‚é¢ï¼Œè€Œä¸æ˜¯ä»£ç é€»è¾‘ã€‚

## ğŸ”§ è§£å†³æ–¹æ¡ˆå¯¹æ¯”

### æ–¹æ¡ˆ1: ç®€åŒ–sqlxé…ç½® (æ¨è)
```rust
// ä½¿ç”¨user-managementçš„æˆåŠŸæ¨¡å¼
let pool = PgPool::connect(&database_url).await?;
```

**ä¼˜ç‚¹ï¼š**
- æœ€å°æ”¹åŠ¨
- ä½¿ç”¨å·²éªŒè¯çš„æˆåŠŸæ¨¡å¼
- ä¿æŒç°æœ‰æ¶æ„

**ç¼ºç‚¹ï¼š**
- å¤±å»é«˜çº§è¿æ¥æ± æ§åˆ¶

### æ–¹æ¡ˆ2: æ›¿æ¢ä¸ºtokio-postgres (å¤‡é€‰)
```rust
// ä½¿ç”¨deadpool-postgresè¿æ¥æ± 
let pool = Pool::builder(mgr)
    .max_size(pool_max_size)
    .build()?;
```

**ä¼˜ç‚¹ï¼š**
- é¿å¼€sqlxçš„é—®é¢˜
- æ›´ç›´æ¥çš„æ•°æ®åº“æ“ä½œ
- æ›´å¥½çš„æ€§èƒ½æ§åˆ¶

**ç¼ºç‚¹ï¼š**
- éœ€è¦é‡å†™æ‰€æœ‰æ•°æ®åº“æ“ä½œ
- å¤±å»sqlxçš„ç±»å‹å®‰å…¨

### æ–¹æ¡ˆ3: åˆ†é˜¶æ®µå¯åŠ¨ (è¾…åŠ©)
```bash
# é¿å…è¿æ¥ç«äº‰
start user-management
sleep 2
start market-data  
sleep 2
start strategy-engine
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ–¹æ¡ˆ | å¯åŠ¨æ—¶é—´ | å†…å­˜ä½¿ç”¨ | è¿æ¥ç¨³å®šæ€§ | å¼€å‘å¤æ‚åº¦ |
|------|----------|----------|------------|------------|
| ç®€åŒ–sqlx | å¿« | ä¸­ç­‰ | é«˜ | ä½ |
| tokio-postgres | ä¸­ç­‰ | ä½ | é«˜ | é«˜ |
| åˆ†é˜¶æ®µå¯åŠ¨ | æ…¢ | ä¸­ç­‰ | ä¸­ç­‰ | ä¸­ç­‰ |

## ğŸ¯ æœ€ç»ˆå»ºè®®

**ç«‹å³æ‰§è¡Œï¼š**
1. å°†æ‰€æœ‰ä¸“ä¸šç‰ˆæœåŠ¡æ”¹ä¸ºä½¿ç”¨user-managementçš„ç®€å•è¿æ¥æ¨¡å¼
2. ç§»é™¤å¤æ‚çš„è¿æ¥æ± é…ç½®å‚æ•°
3. ä½¿ç”¨ç¯å¢ƒå˜é‡æ§åˆ¶åŸºæœ¬è¿æ¥å‚æ•°

**ä»£ç ç¤ºä¾‹ï¼š**
```rust
// æ›¿æ¢å¤æ‚é…ç½®
let database_url = env::var("DATABASE_URL")
    .unwrap_or_else(|_| "postgresql://postgres:password@localhost:5432/trading_db".to_string());

let pool = PgPool::connect(&database_url).await?;
```

**é•¿æœŸä¼˜åŒ–ï¼š**
1. ç›‘æ§è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
2. æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´è¿æ¥æ•°
3. è€ƒè™‘å¼•å…¥è¿æ¥æ± ç›‘æ§

## ğŸ”„ å®æ–½æ­¥éª¤

1. **ä¿®æ”¹trading-engine**: ä½¿ç”¨ç®€åŒ–è¿æ¥æ¨¡å¼
2. **ä¿®æ”¹strategy-engine**: ä½¿ç”¨ç®€åŒ–è¿æ¥æ¨¡å¼  
3. **ä¿®æ”¹ai-service**: ä½¿ç”¨ç®€åŒ–è¿æ¥æ¨¡å¼
4. **æµ‹è¯•éªŒè¯**: ç¡®ä¿æ‰€æœ‰æœåŠ¡æ­£å¸¸å¯åŠ¨
5. **æ€§èƒ½è°ƒä¼˜**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µä¼˜åŒ–

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

- âœ… è§£å†³"expected to read 5 bytes, got 0 bytes at EOF"é”™è¯¯
- âœ… æé«˜æœåŠ¡å¯åŠ¨æˆåŠŸç‡
- âœ… å‡å°‘è¿æ¥æ± ç›¸å…³é—®é¢˜
- âœ… ç®€åŒ–ç»´æŠ¤å¤æ‚åº¦

---

**ç»“è®º**: é€šè¿‡ç®€åŒ–æ•°æ®åº“è¿æ¥é…ç½®ï¼Œé‡‡ç”¨user-managementçš„æˆåŠŸæ¨¡å¼ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³ä¸“ä¸šç‰ˆæœåŠ¡çš„æ•°æ®åº“è¿æ¥é—®é¢˜ã€‚è¿™æ˜¯ä¸€ä¸ªç»è¿‡éªŒè¯çš„ã€é£é™©æœ€ä½çš„è§£å†³æ–¹æ¡ˆã€‚