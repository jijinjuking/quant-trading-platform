# ç­–ç•¥å¼€å‘æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

Strategy Engineæ”¯æŒä¸¤ç§æ–¹å¼æ·»åŠ æ–°ç­–ç•¥ï¼š
1. **é€šè¿‡API/ç®¡ç†åå°** - ä½¿ç”¨ç°æœ‰ç­–ç•¥ç±»å‹ï¼Œé…ç½®å‚æ•°
2. **ç›´æ¥å†™ä»£ç ** - å¼€å‘å…¨æ–°çš„ç­–ç•¥é€»è¾‘

## ğŸ¯ æ–¹å¼1: é€šè¿‡API/ç®¡ç†åå°æ·»åŠ ç­–ç•¥

### é€‚ç”¨åœºæ™¯
- ä½¿ç”¨ç°æœ‰ç­–ç•¥ç±»å‹ï¼ˆMovingAverageCrossoverã€Gridã€DCAç­‰ï¼‰
- åªéœ€è¦è°ƒæ•´å‚æ•°å’Œæ¡ä»¶
- å¿«é€Ÿéƒ¨ç½²å’Œæµ‹è¯•

### å¯ç”¨ç­–ç•¥ç±»å‹
```rust
// è¶‹åŠ¿è·Ÿè¸ªç­–ç•¥
MovingAverageCrossover,    // å‡çº¿äº¤å‰
TrendFollowing,           // è¶‹åŠ¿è·Ÿè¸ª
Breakout,                 // çªç ´ç­–ç•¥

// å‡å€¼å›å½’ç­–ç•¥  
MeanReversion,            // å‡å€¼å›å½’
BollingerBands,           // å¸ƒæ—å¸¦
RSIOversold,              // RSIè¶…å–

// å¥—åˆ©ç­–ç•¥
Arbitrage,                // å¥—åˆ©
PairTrading,              // é…å¯¹äº¤æ˜“

// ç½‘æ ¼ç­–ç•¥
Grid,                     // ç½‘æ ¼äº¤æ˜“
DCA,                      // å®šæŠ•ç­–ç•¥

// æœºå™¨å­¦ä¹ ç­–ç•¥
MLPrediction,             // MLé¢„æµ‹
NeuralNetwork,            // ç¥ç»ç½‘ç»œ

// é«˜é¢‘ç­–ç•¥
HighFrequency,            // é«˜é¢‘äº¤æ˜“
ScalpingStrategy,         // å‰¥å¤´çš®

// æœŸè´§ç­–ç•¥
FuturesArbitrage,         // æœŸè´§å¥—åˆ©
BasisTrading,             // åŸºå·®äº¤æ˜“

// æœŸæƒç­–ç•¥
OptionStrategy,           // æœŸæƒç­–ç•¥
VolatilityTrading,        // æ³¢åŠ¨ç‡äº¤æ˜“

// è‡ªå®šä¹‰ç­–ç•¥
Custom(String),           // å®Œå…¨è‡ªå®šä¹‰
```

### APIä½¿ç”¨ç¤ºä¾‹

#### 1. åˆ›å»ºåŒå‡çº¿ç­–ç•¥
```bash
curl -X POST http://localhost:9001/api/v1/users/{user_id}/strategies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "æˆ‘çš„åŒå‡çº¿ç­–ç•¥",
    "strategy_type": "MovingAverageCrossover",
    "symbols": ["BTCUSDT", "ETHUSDT"],
    "timeframes": ["H1", "H4"],
    "parameters": {
      "indicators": {
        "ma_fast": {"period": 5, "type": "SMA"},
        "ma_slow": {"period": 20, "type": "SMA"}
      },
      "entry_conditions": [{
        "id": "ma_crossover",
        "condition_type": {"Indicator": {"name": "ma_fast"}},
        "operator": "CrossAbove",
        "value": "ma_slow",
        "weight": 1.0,
        "enabled": true
      }]
    }
  }'
```

#### 2. åˆ›å»ºç½‘æ ¼ç­–ç•¥
```bash
curl -X POST http://localhost:9001/api/v1/users/{user_id}/strategies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "BTCç½‘æ ¼ç­–ç•¥",
    "strategy_type": "Grid",
    "symbols": ["BTCUSDT"],
    "timeframes": ["M15"],
    "parameters": {
      "position_size": 100,
      "custom_params": {
        "grid_levels": 10,
        "grid_spacing": 0.02,
        "upper_price": 50000,
        "lower_price": 40000
      }
    }
  }'
```

## ğŸ”§ æ–¹å¼2: ç›´æ¥å†™ä»£ç æ·»åŠ ç­–ç•¥

### é€‚ç”¨åœºæ™¯
- éœ€è¦å…¨æ–°çš„ç­–ç•¥é€»è¾‘
- ç°æœ‰ç­–ç•¥ç±»å‹ä¸æ»¡è¶³éœ€æ±‚
- éœ€è¦å¤æ‚çš„è®¡ç®—å’Œæ¡ä»¶åˆ¤æ–­

### å¼€å‘æ­¥éª¤

#### 1. åˆ›å»ºç­–ç•¥æ–‡ä»¶
åœ¨ `22/services/strategy-engine/src/strategies/` ç›®å½•ä¸‹åˆ›å»ºæ–°æ–‡ä»¶ï¼š

```rust
// 22/services/strategy-engine/src/strategies/my_custom_strategy.rs
use crate::models::*;

pub struct MyCustomStrategy {
    // ç­–ç•¥å‚æ•°
}

impl MyCustomStrategy {
    pub fn new() -> Self {
        // åˆå§‹åŒ–ç­–ç•¥
    }
    
    pub fn calculate_signals(&self, market_data: &MarketData) -> TradingSignal {
        // ç­–ç•¥é€»è¾‘
    }
    
    pub fn to_strategy(&self, user_id: Uuid) -> Strategy {
        // è½¬æ¢ä¸ºé€šç”¨ç­–ç•¥æ ¼å¼
    }
}
```

#### 2. åœ¨mod.rsä¸­æ³¨å†Œ
```rust
// 22/services/strategy-engine/src/strategies/mod.rs
pub mod my_custom_strategy;
pub use my_custom_strategy::MyCustomStrategy;
```

#### 3. æ·»åŠ APIå¤„ç†å™¨
```rust
// 22/services/strategy-engine/src/handlers/custom_strategies.rs
pub async fn create_my_custom_strategy(
    State(state): State<AppState>,
    Path(user_id): Path<Uuid>,
    Json(request): Json<CreateMyCustomRequest>,
) -> Result<Json<StrategyResponse<Strategy>>, StatusCode> {
    // åˆ›å»ºå’Œä¿å­˜ç­–ç•¥
}
```

#### 4. æ·»åŠ è·¯ç”±
```rust
// 22/services/strategy-engine/src/handlers/mod.rs
.route("/api/v1/users/:user_id/custom-strategies/my-strategy", 
       post(custom_strategies::create_my_custom_strategy))
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
22/services/strategy-engine/src/
â”œâ”€â”€ main.rs                    # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ handlers/
â”‚   â”œâ”€â”€ mod.rs                # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ strategies.rs         # é€šç”¨ç­–ç•¥API
â”‚   â”œâ”€â”€ custom_strategies.rs  # è‡ªå®šä¹‰ç­–ç•¥API
â”‚   â””â”€â”€ indicators.rs         # æŠ€æœ¯æŒ‡æ ‡API
â”œâ”€â”€ strategies/               # è‡ªå®šä¹‰ç­–ç•¥å®ç°
â”‚   â”œâ”€â”€ mod.rs               # ç­–ç•¥æ¨¡å—
â”‚   â”œâ”€â”€ custom_macd_strategy.rs  # MACDç­–ç•¥ç¤ºä¾‹
â”‚   â””â”€â”€ your_strategy.rs     # ä½ çš„ç­–ç•¥
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ strategy.rs          # ç­–ç•¥æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ signal.rs           # ä¿¡å·æ¨¡å‹
â”‚   â””â”€â”€ indicator.rs        # æŒ‡æ ‡æ¨¡å‹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ strategy_service.rs  # ç­–ç•¥ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ signal_service.rs   # ä¿¡å·æœåŠ¡
â”‚   â””â”€â”€ indicator_service.rs # æŒ‡æ ‡æœåŠ¡
â””â”€â”€ storage/
    â””â”€â”€ strategy_store.rs    # æ•°æ®å­˜å‚¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨Strategy Engine
```bash
cd 22/services/strategy-engine
cargo run --bin strategy-engine
```

### 2. æµ‹è¯•å¥åº·æ£€æŸ¥
```bash
curl http://localhost:9001/health
```

### 3. åˆ›å»ºç¬¬ä¸€ä¸ªç­–ç•¥
```bash
# ä½¿ç”¨ç°æœ‰æ¨¡æ¿
curl -X POST http://localhost:9001/api/v1/users/$(uuidgen)/strategies \
  -H "Content-Type: application/json" \
  -d @22/create-new-strategy-example.json
```

### 4. æŸ¥çœ‹ç­–ç•¥åˆ—è¡¨
```bash
curl http://localhost:9001/api/v1/users/{user_id}/strategies
```

## ğŸ’¡ æœ€ä½³å®è·µ

### é€šè¿‡APIæ·»åŠ ç­–ç•¥æ—¶ï¼š
1. **å…ˆéªŒè¯é…ç½®** - ä½¿ç”¨validateæ¥å£æ£€æŸ¥å‚æ•°
2. **ä»ç®€å•å¼€å§‹** - å…ˆç”¨åŸºç¡€å‚æ•°ï¼Œå†é€æ­¥ä¼˜åŒ–
3. **å……åˆ†å›æµ‹** - ä½¿ç”¨å†å²æ•°æ®éªŒè¯ç­–ç•¥æ•ˆæœ
4. **é£é™©æ§åˆ¶** - è®¾ç½®åˆç†çš„æ­¢æŸå’Œä»“ä½ç®¡ç†

### ç›´æ¥å†™ä»£ç æ—¶ï¼š
1. **æ¨¡å—åŒ–è®¾è®¡** - å°†ç­–ç•¥é€»è¾‘åˆ†è§£ä¸ºç‹¬ç«‹å‡½æ•°
2. **å‚æ•°å¯é…ç½®** - é¿å…ç¡¬ç¼–ç ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶
3. **å……åˆ†æµ‹è¯•** - ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯é€»è¾‘
4. **é”™è¯¯å¤„ç†** - å¤„ç†å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œæ¡ä»¶
5. **æ€§èƒ½ä¼˜åŒ–** - é¿å…é‡å¤è®¡ç®—ï¼Œä½¿ç”¨ç¼“å­˜

## ğŸ” è°ƒè¯•å’Œç›‘æ§

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹ç­–ç•¥æ‰§è¡Œæ—¥å¿—
tail -f 22/logs/strategy-engine.log

# æŸ¥çœ‹ç‰¹å®šç­–ç•¥æ—¥å¿—
grep "strategy_id" 22/logs/strategy-engine.log
```

### æ€§èƒ½ç›‘æ§
```bash
# æŸ¥çœ‹æŒ‡æ ‡
curl http://localhost:9001/metrics

# æŸ¥çœ‹ç­–ç•¥ç»Ÿè®¡
curl http://localhost:9001/api/v1/users/{user_id}/strategies/statistics
```

## ğŸ“š ç¤ºä¾‹ç­–ç•¥

### 1. è‡ªå®šä¹‰MACDç­–ç•¥
```bash
curl -X POST http://localhost:9001/api/v1/users/{user_id}/custom-strategies/macd \
  -H "Content-Type: application/json" \
  -d '{
    "name": "å¢å¼ºMACDç­–ç•¥",
    "symbols": ["BTCUSDT"],
    "timeframes": ["H1"],
    "config": {
      "fast_period": 12,
      "slow_period": 26,
      "signal_period": 9,
      "entry_threshold": "0.001",
      "exit_threshold": "-0.001"
    }
  }'
```

### 2. RSIè¶…å–ç­–ç•¥
```bash
curl -X POST http://localhost:9001/api/v1/users/{user_id}/strategies \
  -H "Content-Type: application/json" \
  -d '{
    "name": "RSIè¶…å–ç­–ç•¥",
    "strategy_type": "RSIOversold",
    "symbols": ["ETHUSDT"],
    "timeframes": ["H4"],
    "parameters": {
      "indicators": {
        "rsi": {"period": 14}
      },
      "entry_conditions": [{
        "condition_type": {"Indicator": {"name": "rsi"}},
        "operator": "Less",
        "value": 30
      }],
      "exit_conditions": [{
        "condition_type": {"Indicator": {"name": "rsi"}},
        "operator": "Greater", 
        "value": 70
      }]
    }
  }'
```

## ğŸ¯ æ€»ç»“

- **ç®€å•ç­–ç•¥** â†’ ä½¿ç”¨API/ç®¡ç†åå°
- **å¤æ‚ç­–ç•¥** â†’ ç›´æ¥å†™ä»£ç 
- **æ··åˆæ–¹å¼** â†’ ä»£ç å®ç°æ ¸å¿ƒé€»è¾‘ï¼ŒAPIé…ç½®å‚æ•°

Strategy Engineæä¾›äº†çµæ´»çš„ç­–ç•¥å¼€å‘æ¡†æ¶ï¼Œæ—¢æ”¯æŒå¿«é€Ÿé…ç½®ï¼Œä¹Ÿæ”¯æŒæ·±åº¦å®šåˆ¶ã€‚é€‰æ‹©é€‚åˆä½ éœ€æ±‚çš„æ–¹å¼å¼€å§‹ç­–ç•¥å¼€å‘å§ï¼