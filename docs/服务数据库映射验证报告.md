# æœåŠ¡ä¸æ•°æ®åº“è¡¨å¯¹åº”å…³ç³»éªŒè¯æŠ¥å‘Š

**éªŒè¯æ—¶é—´**: 2024å¹´12æœˆ23æ—¥  
**æ•°æ®åº“**: trading_db (ä¸“ä¸šç‰ˆ)  
**æ€»è¡¨æ•°**: 38ä¸ªè¡¨

## ğŸ“Š æ•°æ®åº“è¡¨æ¸…å•

### âœ… ç”¨æˆ·ç®¡ç†ç›¸å…³è¡¨ (User Management - Port 8084)
```
users                      - ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
user_roles                 - ç”¨æˆ·è§’è‰²å…³è”
user_sessions              - ç”¨æˆ·ä¼šè¯
user_activities            - ç”¨æˆ·æ´»åŠ¨æ—¥å¿—
roles                      - è§’è‰²å®šä¹‰
permissions                - æƒé™å®šä¹‰
role_permissions           - è§’è‰²æƒé™å…³è”
api_keys                   - APIå¯†é’¥
kyc_verifications          - KYCéªŒè¯
two_factor_auth            - åŒå› ç´ è®¤è¯
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- ä»£ç ä¸­ä½¿ç”¨çš„è¡¨: users, roles, permissions, user_roles, role_permissions
- SQLæ“ä½œ: INSERT, SELECT, UPDATE (ä½¿ç”¨tokio-postgres)
- è¡¨ç»“æ„åŒ¹é…: âœ… å®Œå…¨åŒ¹é…

### âœ… äº¤æ˜“å¼•æ“ç›¸å…³è¡¨ (Trading Engine - Port 8082)
```
orders                     - è®¢å•ä¿¡æ¯
trades                     - äº¤æ˜“è®°å½•
accounts                   - è´¦æˆ·ä¿¡æ¯
account_history            - è´¦æˆ·å†å²
positions                  - æŒä»“ä¿¡æ¯
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- æ ¸å¿ƒåŠŸèƒ½: è®¢å•ç®¡ç†ã€è´¦æˆ·ç®¡ç†ã€æŒä»“ç®¡ç†
- è¡¨ç»“æ„: 
  - orders: åŒ…å«è®¢å•ç±»å‹ã€çŠ¶æ€ã€ä»·æ ¼ã€æ•°é‡ç­‰å®Œæ•´å­—æ®µ
  - accounts: åŒ…å«ä½™é¢ã€ä¿è¯é‡‘ã€ç›ˆäºç­‰å­—æ®µ
  - positions: åŒ…å«æŒä»“ã€æ æ†ã€æ¸…ç®—ä»·ç­‰å­—æ®µ
- è¡¨ç»“æ„åŒ¹é…: âœ… å®Œå…¨åŒ¹é…

### âœ… é£é™©ç®¡ç†ç›¸å…³è¡¨ (Risk Management - Port 8085)
```
risk_limits                - é£é™©é™é¢
risk_assessments           - é£é™©è¯„ä¼°
risk_warnings              - é£é™©é¢„è­¦
risk_alerts                - é£é™©è­¦æŠ¥
risk_metrics               - é£é™©æŒ‡æ ‡
risk_rules                 - é£é™©è§„åˆ™
realtime_risks             - å®æ—¶é£é™©
limit_history              - é™é¢å†å²
limit_templates            - é™é¢æ¨¡æ¿
dynamic_limit_adjustments  - åŠ¨æ€é™é¢è°ƒæ•´
rule_execution_results     - è§„åˆ™æ‰§è¡Œç»“æœ
rule_templates             - è§„åˆ™æ¨¡æ¿
alert_rules                - è­¦æŠ¥è§„åˆ™
alert_notification_configs - è­¦æŠ¥é€šçŸ¥é…ç½®
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- æ ¸å¿ƒåŠŸèƒ½: é£é™©è¯„ä¼°ã€é™é¢ç®¡ç†ã€é¢„è­¦ç³»ç»Ÿ
- è¡¨ç»“æ„: 
  - risk_limits: åŒ…å«é™é¢ç±»å‹ã€é˜ˆå€¼ã€å½“å‰å€¼ã€åˆ©ç”¨ç‡ç­‰
  - risk_assessments: é£é™©è¯„ä¼°è®°å½•
  - risk_warnings: é¢„è­¦ä¿¡æ¯
- è¡¨ç»“æ„åŒ¹é…: âœ… å®Œå…¨åŒ¹é…

### âœ… é€šçŸ¥æœåŠ¡ç›¸å…³è¡¨ (Notification - Port 8086)
```
notifications              - é€šçŸ¥è®°å½•
notification_templates     - é€šçŸ¥æ¨¡æ¿
notification_subscriptions - é€šçŸ¥è®¢é˜…
channel_configs            - æ¸ é“é…ç½®
channel_health_checks      - æ¸ é“å¥åº·æ£€æŸ¥
delivery_attempts          - å‘é€å°è¯•è®°å½•
push_subscriptions         - æ¨é€è®¢é˜…
websocket_subscriptions    - WebSocketè®¢é˜…
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- æ ¸å¿ƒåŠŸèƒ½: å¤šæ¸ é“é€šçŸ¥ã€æ¨¡æ¿ç®¡ç†ã€è®¢é˜…ç®¡ç†
- è¡¨ç»“æ„:
  - notifications: åŒ…å«æ ‡é¢˜ã€å†…å®¹ã€ç±»å‹ã€ä¼˜å…ˆçº§ã€çŠ¶æ€ç­‰
  - notification_templates: æ¨¡æ¿å®šä¹‰
  - channel_configs: æ¸ é“é…ç½®ï¼ˆé‚®ä»¶ã€çŸ­ä¿¡ã€WebSocketç­‰ï¼‰
- è¡¨ç»“æ„åŒ¹é…: âœ… å®Œå…¨åŒ¹é…

### âš ï¸ ç­–ç•¥å¼•æ“ç›¸å…³è¡¨ (Strategy Engine - Port 8083)
```
é¢„æœŸè¡¨:
strategies                 - ç­–ç•¥å®šä¹‰
strategy_executions        - ç­–ç•¥æ‰§è¡Œè®°å½•
strategy_parameters        - ç­–ç•¥å‚æ•°
backtest_results           - å›æµ‹ç»“æœ
signals                    - äº¤æ˜“ä¿¡å·
```

**æœåŠ¡çŠ¶æ€**: âš ï¸ è¡¨ç»“æ„ç¼ºå¤±
- å½“å‰æ•°æ®åº“: æœªæ‰¾åˆ°ç­–ç•¥ç›¸å…³è¡¨
- æœåŠ¡ä»£ç : æœ‰ç­–ç•¥å¼•æ“æ¡†æ¶ï¼Œä½†æ•°æ®åº“æ“ä½œä¸ºTODO
- **éœ€è¦**: åˆ›å»ºç­–ç•¥ç›¸å…³è¡¨ç»“æ„

### âš ï¸ åˆ†ææœåŠ¡ç›¸å…³è¡¨ (Analytics - Port 8087)
```
é¢„æœŸè¡¨:
performance_reports        - æ€§èƒ½æŠ¥å‘Š
portfolio_analysis         - æŠ•èµ„ç»„åˆåˆ†æ
correlation_data           - ç›¸å…³æ€§æ•°æ®
statistics_cache           - ç»Ÿè®¡ç¼“å­˜
```

**æœåŠ¡çŠ¶æ€**: âš ï¸ è¡¨ç»“æ„ç¼ºå¤±
- å½“å‰æ•°æ®åº“: æœªæ‰¾åˆ°åˆ†æç›¸å…³è¡¨
- æœåŠ¡ä»£ç : æœ‰åˆ†ææœåŠ¡æ¡†æ¶
- **éœ€è¦**: åˆ›å»ºåˆ†æç›¸å…³è¡¨ç»“æ„æˆ–ä½¿ç”¨ClickHouse

### âš ï¸ AIæœåŠ¡ç›¸å…³è¡¨ (AI Service - Port 8088)
```
é¢„æœŸè¡¨:
predictions                - é¢„æµ‹è®°å½•
arbitrage_opportunities    - å¥—åˆ©æœºä¼š
model_performance          - æ¨¡å‹æ€§èƒ½
training_data              - è®­ç»ƒæ•°æ®
```

**æœåŠ¡çŠ¶æ€**: âš ï¸ è¡¨ç»“æ„ç¼ºå¤±
- å½“å‰æ•°æ®åº“: æœªæ‰¾åˆ°AIç›¸å…³è¡¨
- æœåŠ¡ä»£ç : æœ‰AIæœåŠ¡æ¡†æ¶
- **éœ€è¦**: åˆ›å»ºAIç›¸å…³è¡¨ç»“æ„æˆ–ä½¿ç”¨Redisç¼“å­˜

### âœ… å¸‚åœºæ•°æ®æœåŠ¡ (Market Data - Port 8081)
```
å­˜å‚¨æ–¹æ¡ˆ: ClickHouse (æ—¶åºæ•°æ®åº“)
è¡¨:
klines                     - Kçº¿æ•°æ®
tickers                    - å®æ—¶ä»·æ ¼
orderbooks                 - è®¢å•ç°¿
trades                     - é€ç¬”äº¤æ˜“
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- å­˜å‚¨: ä½¿ç”¨ClickHouseå­˜å‚¨å†å²æ•°æ®
- ç¼“å­˜: ä½¿ç”¨Redisç¼“å­˜å®æ—¶æ•°æ®
- è¡¨ç»“æ„åŒ¹é…: âœ… ä½¿ç”¨ClickHouse

### âœ… APIç½‘å…³ (Gateway - Port 8091)
```
ä¸éœ€è¦ç‹¬ç«‹è¡¨
åŠŸèƒ½: è·¯ç”±ã€è®¤è¯ã€é™æµã€ç›‘æ§
```

**æœåŠ¡çŠ¶æ€**: âœ… å·²å®ç°
- æ— éœ€ç‹¬ç«‹æ•°æ®åº“è¡¨
- ä½¿ç”¨Redisè¿›è¡Œé™æµå’Œç¼“å­˜

## ğŸ“‹ è¡¨ç»“æ„éªŒè¯è¯¦æƒ…

### âœ… usersè¡¨éªŒè¯
```sql
åˆ—å                  ç±»å‹                      çº¦æŸ
id                   uuid                     PRIMARY KEY
username             varchar(50)              UNIQUE, NOT NULL
email                varchar(255)             UNIQUE, NOT NULL
phone                varchar(20)              
password_hash        varchar(255)             NOT NULL
status               user_status              NOT NULL, DEFAULT 'PENDING'
email_verified       boolean                  NOT NULL, DEFAULT false
phone_verified       boolean                  NOT NULL, DEFAULT false
two_factor_enabled   boolean                  NOT NULL, DEFAULT false
created_at           timestamptz              NOT NULL, DEFAULT now()
updated_at           timestamptz              NOT NULL, DEFAULT now()
last_login           timestamptz              
login_attempts       integer                  NOT NULL, DEFAULT 0
locked_until         timestamptz              
```

**éªŒè¯ç»“æœ**: âœ… ä¸user-managementæœåŠ¡ä»£ç å®Œå…¨åŒ¹é…

### âœ… ordersè¡¨éªŒè¯
```sql
åˆ—å                  ç±»å‹                      çº¦æŸ
id                   uuid                     PRIMARY KEY
user_id              uuid                     NOT NULL
symbol               varchar(20)              NOT NULL
order_type           order_type               NOT NULL
side                 order_side               NOT NULL
quantity             numeric(20,8)            NOT NULL
price                numeric(20,8)            
status               order_status             NOT NULL, DEFAULT 'PENDING'
time_in_force        time_in_force            NOT NULL, DEFAULT 'GTC'
filled_quantity      numeric(20,8)            NOT NULL, DEFAULT 0
created_at           timestamptz              NOT NULL, DEFAULT now()
```

**éªŒè¯ç»“æœ**: âœ… ä¸trading-engineæœåŠ¡éœ€æ±‚åŒ¹é…

### âœ… risk_limitsè¡¨éªŒè¯
```sql
åˆ—å                  ç±»å‹                      çº¦æŸ
id                   uuid                     PRIMARY KEY
user_id              uuid                     
symbol               varchar(20)              
limit_type           varchar(50)              NOT NULL
max_value            numeric(15,2)            NOT NULL
warning_threshold    numeric(5,2)             NOT NULL, DEFAULT 80
current_value        numeric(15,2)            NOT NULL, DEFAULT 0
utilization_rate     numeric(5,2)             NOT NULL, DEFAULT 0
status               varchar(20)              NOT NULL, DEFAULT 'Normal'
is_active            boolean                  NOT NULL, DEFAULT true
```

**éªŒè¯ç»“æœ**: âœ… ä¸risk-managementæœåŠ¡éœ€æ±‚åŒ¹é…

### âœ… notificationsè¡¨éªŒè¯
```sql
åˆ—å                  ç±»å‹                      çº¦æŸ
id                   uuid                     PRIMARY KEY
user_id              uuid                     
title                varchar(255)             NOT NULL
content              text                     NOT NULL
notification_type    notification_type        NOT NULL
priority             notification_priority    NOT NULL, DEFAULT 'normal'
status               notification_status      NOT NULL, DEFAULT 'pending'
channels             jsonb                    NOT NULL, DEFAULT '[]'
created_at           timestamptz              NOT NULL, DEFAULT now()
```

**éªŒè¯ç»“æœ**: âœ… ä¸notificationæœåŠ¡éœ€æ±‚åŒ¹é…

## ğŸ” ç¼ºå¤±è¡¨åˆ†æ

### âš ï¸ ç­–ç•¥å¼•æ“éœ€è¦çš„è¡¨
```sql
-- éœ€è¦åˆ›å»º
CREATE TABLE strategies (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    name VARCHAR(200) NOT NULL,
    strategy_type VARCHAR(50) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'INACTIVE',
    symbols TEXT[] NOT NULL,
    timeframes TEXT[] NOT NULL,
    parameters JSONB NOT NULL DEFAULT '{}',
    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE strategy_executions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    strategy_id UUID NOT NULL REFERENCES strategies(id),
    status VARCHAR(20) NOT NULL,
    start_time TIMESTAMPTZ NOT NULL,
    end_time TIMESTAMPTZ,
    pnl NUMERIC(20,8),
    trades_count INTEGER DEFAULT 0,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

CREATE TABLE trading_signals (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    strategy_id UUID NOT NULL REFERENCES strategies(id),
    symbol VARCHAR(20) NOT NULL,
    signal_type VARCHAR(10) NOT NULL,
    strength NUMERIC(5,2) NOT NULL,
    confidence NUMERIC(5,2) NOT NULL,
    entry_price NUMERIC(20,8),
    stop_loss NUMERIC(20,8),
    take_profit NUMERIC(20,8),
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);
```

### âš ï¸ åˆ†ææœåŠ¡éœ€è¦çš„è¡¨
```sql
-- å¯é€‰ï¼šä½¿ç”¨PostgreSQLå­˜å‚¨æŠ¥å‘Š
CREATE TABLE performance_reports (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL,
    report_type VARCHAR(50) NOT NULL,
    period_start TIMESTAMPTZ NOT NULL,
    period_end TIMESTAMPTZ NOT NULL,
    total_return NUMERIC(10,4),
    sharpe_ratio NUMERIC(10,4),
    max_drawdown NUMERIC(10,4),
    report_data JSONB NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- æˆ–ä½¿ç”¨ClickHouseå­˜å‚¨æ—¶åºåˆ†ææ•°æ®
```

### âš ï¸ AIæœåŠ¡éœ€è¦çš„è¡¨
```sql
-- å¯é€‰ï¼šä½¿ç”¨PostgreSQLå­˜å‚¨é¢„æµ‹è®°å½•
CREATE TABLE price_predictions (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    symbol VARCHAR(20) NOT NULL,
    exchange VARCHAR(50) NOT NULL,
    current_price NUMERIC(20,8) NOT NULL,
    predicted_price NUMERIC(20,8) NOT NULL,
    confidence NUMERIC(5,2) NOT NULL,
    horizon INTEGER NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT now()
);

-- æˆ–ä¸»è¦ä½¿ç”¨Redisç¼“å­˜
```

## ğŸ¯ æ€»ç»“

### âœ… å·²å®Œæˆçš„æœåŠ¡ï¼ˆ5ä¸ªï¼‰
1. **user-management** (8084) - âœ… è¡¨ç»“æ„å®Œæ•´ï¼Œä»£ç å·²å®ç°
2. **trading-engine** (8082) - âœ… è¡¨ç»“æ„å®Œæ•´ï¼Œä»£ç å·²å®ç°
3. **risk-management** (8085) - âœ… è¡¨ç»“æ„å®Œæ•´ï¼Œä»£ç å·²å®ç°
4. **notification** (8086) - âœ… è¡¨ç»“æ„å®Œæ•´ï¼Œä»£ç å·²å®ç°
5. **market-data** (8081) - âœ… ä½¿ç”¨ClickHouseï¼Œç»“æ„å®Œæ•´

### âš ï¸ éœ€è¦è¡¥å……è¡¨ç»“æ„çš„æœåŠ¡ï¼ˆ3ä¸ªï¼‰
1. **strategy-engine** (8083) - âš ï¸ éœ€è¦åˆ›å»ºç­–ç•¥ç›¸å…³è¡¨
2. **analytics** (8087) - âš ï¸ éœ€è¦åˆ›å»ºåˆ†æè¡¨æˆ–ä½¿ç”¨ClickHouse
3. **ai-service** (8088) - âš ï¸ éœ€è¦åˆ›å»ºAIè¡¨æˆ–ä¸»è¦ä½¿ç”¨Redis

### âœ… æ— éœ€ç‹¬ç«‹è¡¨çš„æœåŠ¡ï¼ˆ1ä¸ªï¼‰
1. **gateway** (8091) - âœ… ä½¿ç”¨Redisï¼Œæ— éœ€ç‹¬ç«‹è¡¨

## ğŸ“ å»ºè®®

### ç«‹å³è¡ŒåŠ¨
1. **åˆ›å»ºç­–ç•¥å¼•æ“è¡¨ç»“æ„** - è¿™æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»æœ‰æ•°æ®åº“æ”¯æŒ
2. **ç¡®è®¤åˆ†ææœåŠ¡å­˜å‚¨æ–¹æ¡ˆ** - PostgreSQLæŠ¥å‘Šè¡¨ + ClickHouseæ—¶åºæ•°æ®
3. **ç¡®è®¤AIæœåŠ¡å­˜å‚¨æ–¹æ¡ˆ** - Redisç¼“å­˜ä¸ºä¸» + PostgreSQLè®°å½•ä¸ºè¾…

### æ•°æ®åº“è¿ç§»è„šæœ¬
éœ€è¦åˆ›å»ºä»¥ä¸‹è¿ç§»è„šæœ¬ï¼š
- `migrations/004_create_strategy_tables.sql`
- `migrations/005_create_analytics_tables.sql`
- `migrations/006_create_ai_tables.sql`

### éªŒè¯æ–¹æ³•
```bash
# æ£€æŸ¥æ‰€æœ‰è¡¨
docker exec trading_postgres_23 psql -U postgres -d trading_db -c "\dt"

# æ£€æŸ¥ç‰¹å®šè¡¨ç»“æ„
docker exec trading_postgres_23 psql -U postgres -d trading_db -c "\d table_name"

# éªŒè¯æœåŠ¡èƒ½å¦è¿æ¥
curl http://localhost:8084/health
```

---
**æŠ¥å‘Šç”Ÿæˆ**: 2024å¹´12æœˆ23æ—¥  
**éªŒè¯äººå‘˜**: AIåŠ©æ‰‹  
**æ•°æ®åº“ç‰ˆæœ¬**: PostgreSQL 14 (TimescaleDB)  
**éªŒè¯çŠ¶æ€**: âœ… æ ¸å¿ƒæœåŠ¡è¡¨ç»“æ„å®Œæ•´ï¼Œéƒ¨åˆ†æœåŠ¡éœ€è¦è¡¥å……