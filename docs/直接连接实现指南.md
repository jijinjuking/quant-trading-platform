# ä¸“ä¸šç‰ˆæœåŠ¡ç›´è¿æ¨¡å¼å®æ–½æŒ‡å—

## é—®é¢˜æ€»ç»“

é€šè¿‡æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬ç¡®è®¤äº†ä¸“ä¸šç‰ˆæœåŠ¡æ•°æ®åº“è¿æ¥å¤±è´¥çš„æ ¹æœ¬åŸå› ï¼š

**å¤æ‚è¿æ¥æ± é…ç½®å¯¼è‡´è¿æ¥å¤±è´¥**
- user-managementä½¿ç”¨ç®€å•ç›´è¿æˆåŠŸ âœ…
- ä¸“ä¸šç‰ˆæœåŠ¡ä½¿ç”¨å¤æ‚è¿æ¥æ± å¤±è´¥ âŒ

## è§£å†³æ–¹æ¡ˆï¼šç›´è¿æ¨¡å¼

é‡‡ç”¨user-managementçš„æˆåŠŸæ¨¡å¼ï¼Œä½¿ç”¨ç®€å•ç›´è¿æ›¿ä»£å¤æ‚è¿æ¥æ± é…ç½®ã€‚

### æ ¸å¿ƒä»£ç æ¨¡å¼

```rust
// âœ… æˆåŠŸæ¨¡å¼ (user-management)
let pool = PgPool::connect(&database_url).await?;

// âŒ å¤±è´¥æ¨¡å¼ (ä¸“ä¸šç‰ˆæœåŠ¡)
let pool = PgPoolOptions::new()
    .max_connections(config.database.max_connections)
    .min_connections(config.database.min_connections)
    .connect_timeout(config.database.connect_timeout)
    .idle_timeout(config.database.idle_timeout)
    .max_lifetime(config.database.max_lifetime)
    .connect(&config.database.url)
    .await?;
```

## å®æ–½æ­¥éª¤

### 1. ä¿®æ”¹trading-engine

**æ–‡ä»¶**: `services/trading-engine/src/main.rs`

```rust
use anyhow::Result;
use dotenvy::dotenv;
use tracing::info;
use tracing_subscriber::{layer::SubscriberExt, util::SubscriberInitExt};

#[tokio::main]
async fn main() -> Result<()> {
    dotenv().ok();
    
    tracing_subscriber::registry()
        .with(
            tracing_subscriber::EnvFilter::try_from_default_env()
                .unwrap_or_else(|_| "trading_engine=info".into()),
        )
        .with(tracing_subscriber::fmt::layer())
        .init();

    info!("ğŸš€ äº¤æ˜“å¼•æ“å¯åŠ¨ä¸­...");

    // ç®€å•ç›´è¿ - å’Œuser-managementä¸€æ ·
    let database_url = std::env::var("DATABASE_URL")
        .unwrap_or_else(|_| "postgresql://postgres:password@localhost:5432/trading_db".to_string());
    
    let port = std::env::var("TRADING_ENGINE_PORT")
        .unwrap_or_else(|_| "8082".to_string())
        .parse::<u16>()
        .unwrap_or(8082);

    // ç›´è¿æ¨¡å¼
    let pool = sqlx::PgPool::connect(&database_url).await?;
    info!("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ");

    // æµ‹è¯•è¿æ¥
    sqlx::query("SELECT 1").execute(&pool).await?;
    info!("âœ… æ•°æ®åº“æµ‹è¯•æˆåŠŸ");

    // æ„å»ºåº”ç”¨
    let app = handlers::create_app(pool).await?;
    
    // å¯åŠ¨æœåŠ¡å™¨
    let listener = tokio::net::TcpListener::bind(&format!("0.0.0.0:{}", port)).await?;
    info!("ğŸš€ äº¤æ˜“å¼•æ“å¯åŠ¨æˆåŠŸ - ç«¯å£: {}", port);

    axum::serve(listener, app).await?;

    Ok(())
}
```

### 2. ä¿®æ”¹strategy-engine

**æ–‡ä»¶**: `services/strategy-engine/src/main.rs`

```rust
use anyhow::Result;
use dotenvy::dotenv;
use tracing::info;
use tracing_subscriber::{layer::SubscriberExt, util::SubscriberInitExt};

#[tokio::main]
async fn main() -> Result<()> {
    dotenv().ok();
    
    tracing_subscriber::registry()
        .with(
            tracing_subscriber::EnvFilter::try_from_default_env()
                .unwrap_or_else(|_| "strategy_engine=info".into()),
        )
        .with(tracing_subscriber::fmt::layer())
        .init();

    info!("ğŸš€ ç­–ç•¥å¼•æ“å¯åŠ¨ä¸­...");

    // ç®€å•ç›´è¿ - å’Œuser-managementä¸€æ ·
    let database_url = std::env::var("DATABASE_URL")
        .unwrap_or_else(|_| "postgresql://postgres:password@localhost:5432/trading_db".to_string());
    
    let port = std::env::var("STRATEGY_ENGINE_PORT")
        .unwrap_or_else(|_| "9001".to_string())
        .parse::<u16>()
        .unwrap_or(9001);

    // ç›´è¿æ¨¡å¼
    let pool = sqlx::PgPool::connect(&database_url).await?;
    info!("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ");

    // æµ‹è¯•è¿æ¥
    sqlx::query("SELECT 1").execute(&pool).await?;
    info!("âœ… æ•°æ®åº“æµ‹è¯•æˆåŠŸ");

    // æ„å»ºåº”ç”¨
    let app = handlers::create_app(pool).await?;
    
    // å¯åŠ¨æœåŠ¡å™¨
    let listener = tokio::net::TcpListener::bind(&format!("0.0.0.0:{}", port)).await?;
    info!("ğŸš€ ç­–ç•¥å¼•æ“å¯åŠ¨æˆåŠŸ - ç«¯å£: {}", port);

    axum::serve(listener, app).await?;

    Ok(())
}
```

### 3. ä¿®æ”¹ai-service

**æ–‡ä»¶**: `services/ai-service/src/main.rs`

åŒæ ·çš„æ¨¡å¼ï¼Œåªéœ€ä¿®æ”¹æœåŠ¡åç§°å’Œç«¯å£ã€‚

## å…³é”®æ”¹åŠ¨ç‚¹

### ç§»é™¤å¤æ‚é…ç½®

**åˆ é™¤**:
```rust
use config::TradingEngineConfig;  // åˆ é™¤å¤æ‚é…ç½®ç»“æ„

let config = TradingEngineConfig::load()?;  // åˆ é™¤é…ç½®åŠ è½½

let pool = PgPoolOptions::new()  // åˆ é™¤å¤æ‚è¿æ¥æ± 
    .max_connections(config.database.max_connections)
    ...
```

**æ›¿æ¢ä¸º**:
```rust
let database_url = std::env::var("DATABASE_URL")
    .unwrap_or_else(|_| "postgresql://postgres:password@localhost:5432/trading_db".to_string());

let pool = sqlx::PgPool::connect(&database_url).await?;
```

## ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿`.env.database`æ–‡ä»¶åŒ…å«ï¼š

```bash
DATABASE_URL=postgresql://postgres:password@localhost:5432/trading_db
TRADING_ENGINE_PORT=8082
STRATEGY_ENGINE_PORT=9001
AI_SERVICE_PORT=8087
```

## ç¼–è¯‘å’Œæµ‹è¯•

```bash
# ç¼–è¯‘
cargo build --release

# æµ‹è¯•trading-engine
cargo run --bin trading-engine

# æµ‹è¯•strategy-engine
cargo run --bin strategy-engine

# æµ‹è¯•ai-service
cargo run --bin ai-service
```

## é¢„æœŸæ•ˆæœ

- âœ… è§£å†³"expected to read 5 bytes, got 0 bytes at EOF"é”™è¯¯
- âœ… æé«˜æœåŠ¡å¯åŠ¨æˆåŠŸç‡
- âœ… ç®€åŒ–ç»´æŠ¤å¤æ‚åº¦
- âœ… ä½¿ç”¨ç»è¿‡éªŒè¯çš„æˆåŠŸæ¨¡å¼

## åç»­ä¼˜åŒ–

ç­‰æœåŠ¡ç¨³å®šè¿è¡Œåï¼Œå¯ä»¥è€ƒè™‘ï¼š

1. æ·»åŠ è¿æ¥æ± ç›‘æ§
2. æ ¹æ®å®é™…è´Ÿè½½è°ƒæ•´è¿æ¥æ•°
3. å®æ–½è¿æ¥æ± å¥åº·æ£€æŸ¥
4. ä¼˜åŒ–è¿æ¥è¶…æ—¶å‚æ•°

## æ³¨æ„äº‹é¡¹

1. **ä¿æŒç®€å•**: ä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼Œå…ˆç¡®ä¿æœåŠ¡èƒ½ç¨³å®šè¿è¡Œ
2. **é€æ­¥è¿ç§»**: ä¸€æ¬¡ä¿®æ”¹ä¸€ä¸ªæœåŠ¡ï¼Œæµ‹è¯•é€šè¿‡åå†ç»§ç»­
3. **ä¿ç•™å¤‡ä»½**: ä¿®æ”¹å‰å¤‡ä»½åŸæœ‰ä»£ç 
4. **ç›‘æ§æ—¥å¿—**: å…³æ³¨å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤è¿æ¥æˆåŠŸ

---

**ç»“è®º**: ç›´è¿æ¨¡å¼æ˜¯ç»è¿‡user-managementéªŒè¯çš„æˆåŠŸæ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³ä¸“ä¸šç‰ˆæœåŠ¡çš„æ•°æ®åº“è¿æ¥é—®é¢˜ã€‚