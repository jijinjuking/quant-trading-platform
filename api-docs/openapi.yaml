openapi: 3.0.3
info:
  title: 量化交易系统 API
  description: 专业级量化交易平台的RESTful API接口文档
  version: 1.0.0
  contact:
    name: API Support
    email: support@trading-platform.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8091
    description: 开发环境网关
  - url: https://api.trading-platform.com
    description: 生产环境

security:
  - BearerAuth: []

paths:
  # 用户认证
  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: 用户登录
      description: 使用用户名和密码进行身份验证
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  example: "john_doe"
                password:
                  type: string
                  format: password
                  example: "secure_password"
      responses:
        '200':
          description: 登录成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/User'
                          token:
                            type: string
                            example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                          expires_in:
                            type: integer
                            example: 86400
        '401':
          description: 认证失败
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/register:
    post:
      tags:
        - Authentication
      summary: 用户注册
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
                - confirm_password
              properties:
                username:
                  type: string
                  example: "new_user"
                email:
                  type: string
                  format: email
                  example: "user@example.com"
                password:
                  type: string
                  format: password
                  minLength: 8
                confirm_password:
                  type: string
                  format: password
      responses:
        '201':
          description: 注册成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'

  /api/v1/users/profile:
    get:
      tags:
        - User Management
      summary: 获取当前用户信息
      responses:
        '200':
          description: 用户信息
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'

  # 交易功能
  /api/v1/orders:
    post:
      tags:
        - Trading
      summary: 创建订单
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
      responses:
        '201':
          description: 订单创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Order'
    get:
      tags:
        - Trading
      summary: 查询订单列表
      parameters:
        - name: symbol
          in: query
          schema:
            type: string
          example: "BTCUSDT"
        - name: status
          in: query
          schema:
            type: string
            enum: [NEW, PARTIALLY_FILLED, FILLED, CANCELED, EXPIRED]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: 订单列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaginatedOrders'

  /api/v1/orders/{orderId}:
    get:
      tags:
        - Trading
      summary: 查询单个订单
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 订单详情
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OrderDetail'
    delete:
      tags:
        - Trading
      summary: 取消订单
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 订单取消成功

  /api/v1/positions:
    get:
      tags:
        - Trading
      summary: 查询持仓
      responses:
        '200':
          description: 持仓列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Position'

  /api/v1/balances:
    get:
      tags:
        - Trading
      summary: 查询账户余额
      responses:
        '200':
          description: 账户余额
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Balance'

  # 市场数据
  /api/v1/market/klines:
    get:
      tags:
        - Market Data
      summary: 获取K线数据
      security: []
      parameters:
        - name: symbol
          in: query
          required: true
          schema:
            type: string
          example: "BTCUSDT"
        - name: interval
          in: query
          required: true
          schema:
            type: string
            enum: [1m, 5m, 15m, 30m, 1h, 4h, 1d, 1w, 1M]
          example: "1h"
        - name: limit
          in: query
          schema:
            type: integer
            default: 500
            maximum: 1000
        - name: start_time
          in: query
          schema:
            type: integer
            format: int64
        - name: end_time
          in: query
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: K线数据
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Kline'

  /api/v1/market/tickers:
    get:
      tags:
        - Market Data
      summary: 获取实时价格
      security: []
      parameters:
        - name: symbol
          in: query
          schema:
            type: string
          example: "BTCUSDT"
      responses:
        '200':
          description: 价格数据
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Ticker'

  /api/v1/market/orderbook:
    get:
      tags:
        - Market Data
      summary: 获取订单簿
      security: []
      parameters:
        - name: symbol
          in: query
          required: true
          schema:
            type: string
          example: "BTCUSDT"
        - name: limit
          in: query
          schema:
            type: integer
            enum: [5, 10, 20, 50, 100, 500, 1000]
            default: 100
      responses:
        '200':
          description: 订单簿数据
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/OrderBook'

  # 策略管理
  /api/v1/strategies:
    post:
      tags:
        - Strategy
      summary: 创建策略
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStrategyRequest'
      responses:
        '201':
          description: 策略创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Strategy'
    get:
      tags:
        - Strategy
      summary: 查询策略列表
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [ACTIVE, INACTIVE, PAUSED]
        - name: type
          in: query
          schema:
            type: string
            enum: [RSI, MACD, MULTI_FACTOR, GRID, ARBITRAGE]
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: 策略列表
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/PaginatedStrategies'

  /api/v1/strategies/{strategyId}:
    get:
      tags:
        - Strategy
      summary: 查询策略详情
      parameters:
        - name: strategyId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 策略详情
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/StrategyDetail'

  /api/v1/strategies/{strategyId}/start:
    post:
      tags:
        - Strategy
      summary: 启动策略
      parameters:
        - name: strategyId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 策略启动成功

  /api/v1/strategies/{strategyId}/stop:
    post:
      tags:
        - Strategy
      summary: 停止策略
      parameters:
        - name: strategyId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 策略停止成功

  # 回测
  /api/v1/backtests:
    post:
      tags:
        - Backtest
      summary: 创建回测
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBacktestRequest'
      responses:
        '201':
          description: 回测创建成功
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Backtest'

  /api/v1/backtests/{backtestId}:
    get:
      tags:
        - Backtest
      summary: 查询回测结果
      parameters:
        - name: backtestId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 回测结果
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/BacktestResult'

  # 系统功能
  /health:
    get:
      tags:
        - System
      summary: 健康检查
      security: []
      responses:
        '200':
          description: 系统健康状态
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        error:
          $ref: '#/components/schemas/ApiError'
        timestamp:
          type: string
          format: date-time
        request_id:
          type: string

    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/ApiResponse'
        - type: object
          properties:
            success:
              type: boolean
              example: false
            data:
              type: object
              nullable: true
              example: null

    ApiError:
      type: object
      properties:
        code:
          type: string
          example: "VALIDATION_ERROR"
        message:
          type: string
          example: "用户名或密码错误"
        details:
          type: object
          nullable: true

    User:
      type: object
      properties:
        id:
          type: string
          example: "user_123"
        username:
          type: string
          example: "john_doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        role:
          type: string
          example: "trader"
        balance:
          type: number
          format: double
          example: 10000.00
        created_at:
          type: string
          format: date-time
        last_login:
          type: string
          format: date-time

    CreateOrderRequest:
      type: object
      required:
        - symbol
        - side
        - type
        - quantity
      properties:
        symbol:
          type: string
          example: "BTCUSDT"
        side:
          type: string
          enum: [BUY, SELL]
          example: "BUY"
        type:
          type: string
          enum: [MARKET, LIMIT, STOP_LOSS, TAKE_PROFIT]
          example: "LIMIT"
        quantity:
          type: number
          format: double
          example: 0.001
        price:
          type: number
          format: double
          example: 45000.00
        time_in_force:
          type: string
          enum: [GTC, IOC, FOK]
          default: "GTC"

    Order:
      type: object
      properties:
        order_id:
          type: string
          example: "order_123456"
        symbol:
          type: string
          example: "BTCUSDT"
        side:
          type: string
          enum: [BUY, SELL]
        type:
          type: string
          enum: [MARKET, LIMIT, STOP_LOSS, TAKE_PROFIT]
        quantity:
          type: number
          format: double
        price:
          type: number
          format: double
        filled_quantity:
          type: number
          format: double
        status:
          type: string
          enum: [NEW, PARTIALLY_FILLED, FILLED, CANCELED, EXPIRED]
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrderDetail:
      allOf:
        - $ref: '#/components/schemas/Order'
        - type: object
          properties:
            average_price:
              type: number
              format: double
            trades:
              type: array
              items:
                $ref: '#/components/schemas/Trade'

    Trade:
      type: object
      properties:
        trade_id:
          type: string
        quantity:
          type: number
          format: double
        price:
          type: number
          format: double
        fee:
          type: number
          format: double
        fee_asset:
          type: string
        timestamp:
          type: string
          format: date-time

    Position:
      type: object
      properties:
        symbol:
          type: string
        side:
          type: string
          enum: [LONG, SHORT]
        size:
          type: number
          format: double
        entry_price:
          type: number
          format: double
        mark_price:
          type: number
          format: double
        unrealized_pnl:
          type: number
          format: double
        realized_pnl:
          type: number
          format: double
        margin:
          type: number
          format: double
        percentage:
          type: number
          format: double
        created_at:
          type: string
          format: date-time

    Balance:
      type: object
      properties:
        total_balance:
          type: number
          format: double
        available_balance:
          type: number
          format: double
        frozen_balance:
          type: number
          format: double
        assets:
          type: array
          items:
            type: object
            properties:
              asset:
                type: string
              free:
                type: number
                format: double
              locked:
                type: number
                format: double
              total:
                type: number
                format: double

    Kline:
      type: object
      properties:
        open_time:
          type: integer
          format: int64
        open:
          type: string
        high:
          type: string
        low:
          type: string
        close:
          type: string
        volume:
          type: string
        close_time:
          type: integer
          format: int64
        quote_volume:
          type: string
        count:
          type: integer
        taker_buy_volume:
          type: string
        taker_buy_quote_volume:
          type: string

    Ticker:
      type: object
      properties:
        symbol:
          type: string
        price:
          type: string
        price_change:
          type: string
        price_change_percent:
          type: string
        high_24h:
          type: string
        low_24h:
          type: string
        volume_24h:
          type: string
        quote_volume_24h:
          type: string
        open_24h:
          type: string
        timestamp:
          type: integer
          format: int64

    OrderBook:
      type: object
      properties:
        symbol:
          type: string
        bids:
          type: array
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
        asks:
          type: array
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
        timestamp:
          type: integer
          format: int64

    CreateStrategyRequest:
      type: object
      required:
        - name
        - type
        - symbol
        - parameters
      properties:
        name:
          type: string
        description:
          type: string
        type:
          type: string
          enum: [RSI, MACD, MULTI_FACTOR, GRID, ARBITRAGE]
        symbol:
          type: string
        parameters:
          type: object
        risk_management:
          type: object

    Strategy:
      type: object
      properties:
        strategy_id:
          type: string
        name:
          type: string
        type:
          type: string
        symbol:
          type: string
        status:
          type: string
          enum: [ACTIVE, INACTIVE, PAUSED]
        parameters:
          type: object
        performance:
          $ref: '#/components/schemas/StrategyPerformance'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    StrategyDetail:
      allOf:
        - $ref: '#/components/schemas/Strategy'
        - type: object
          properties:
            description:
              type: string
            risk_management:
              type: object
            recent_signals:
              type: array
              items:
                $ref: '#/components/schemas/Signal'

    StrategyPerformance:
      type: object
      properties:
        total_return:
          type: number
          format: double
        daily_return:
          type: number
          format: double
        max_drawdown:
          type: number
          format: double
        sharpe_ratio:
          type: number
          format: double
        win_rate:
          type: number
          format: double
        total_trades:
          type: integer
        winning_trades:
          type: integer
        losing_trades:
          type: integer

    Signal:
      type: object
      properties:
        signal_id:
          type: string
        type:
          type: string
          enum: [BUY, SELL, HOLD]
        price:
          type: number
          format: double
        confidence:
          type: number
          format: double
        timestamp:
          type: string
          format: date-time

    CreateBacktestRequest:
      type: object
      required:
        - strategy_id
        - symbol
        - start_date
        - end_date
        - initial_capital
      properties:
        strategy_id:
          type: string
        symbol:
          type: string
        start_date:
          type: string
          format: date
        end_date:
          type: string
          format: date
        initial_capital:
          type: number
          format: double
        commission:
          type: number
          format: double
        slippage:
          type: number
          format: double

    Backtest:
      type: object
      properties:
        backtest_id:
          type: string
        strategy_id:
          type: string
        status:
          type: string
          enum: [RUNNING, COMPLETED, FAILED]
        progress:
          type: integer
          minimum: 0
          maximum: 100
        estimated_completion:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time

    BacktestResult:
      allOf:
        - $ref: '#/components/schemas/Backtest'
        - type: object
          properties:
            results:
              $ref: '#/components/schemas/BacktestMetrics'
            equity_curve:
              type: array
              items:
                $ref: '#/components/schemas/EquityPoint'
            trades:
              type: array
              items:
                $ref: '#/components/schemas/BacktestTrade'
            completed_at:
              type: string
              format: date-time

    BacktestMetrics:
      type: object
      properties:
        initial_capital:
          type: number
          format: double
        final_capital:
          type: number
          format: double
        total_return:
          type: number
          format: double
        annual_return:
          type: number
          format: double
        max_drawdown:
          type: number
          format: double
        sharpe_ratio:
          type: number
          format: double
        sortino_ratio:
          type: number
          format: double
        win_rate:
          type: number
          format: double
        profit_factor:
          type: number
          format: double
        total_trades:
          type: integer
        winning_trades:
          type: integer
        losing_trades:
          type: integer
        average_win:
          type: number
          format: double
        average_loss:
          type: number
          format: double
        largest_win:
          type: number
          format: double
        largest_loss:
          type: number
          format: double

    EquityPoint:
      type: object
      properties:
        date:
          type: string
          format: date
        equity:
          type: number
          format: double
        drawdown:
          type: number
          format: double

    BacktestTrade:
      type: object
      properties:
        entry_time:
          type: string
          format: date-time
        exit_time:
          type: string
          format: date-time
        side:
          type: string
          enum: [BUY, SELL]
        entry_price:
          type: number
          format: double
        exit_price:
          type: number
          format: double
        quantity:
          type: number
          format: double
        pnl:
          type: number
          format: double
        commission:
          type: number
          format: double
        net_pnl:
          type: number
          format: double

    PaginatedOrders:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Order'
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    PaginatedStrategies:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Strategy'
        pagination:
          $ref: '#/components/schemas/PaginationInfo'

    PaginationInfo:
      type: object
      properties:
        current_page:
          type: integer
        page_size:
          type: integer
        total_items:
          type: integer
          format: int64
        total_pages:
          type: integer
        has_next:
          type: boolean
        has_prev:
          type: boolean

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        timestamp:
          type: string
          format: date-time
        version:
          type: string
        uptime:
          type: integer
          format: int64
        checks:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/ServiceHealth'

    ServiceHealth:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, degraded, unhealthy]
        message:
          type: string
        response_time_ms:
          type: integer
          format: int64